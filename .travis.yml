
language: c
git:
  depth: 3
dist:
  trusty

branches:
  only:
    - master
    - dev

before_install:
    - sudo apt-get update -qq
    - sudo apt-get install -qq check    

matrix:
  include:
    - compiler: gcc
      env: ENABLE_COVERAGE=--enable-coverage
      after_sucess:
        - coveralls --exclude tests --exclude src/lexer.l --exclude src/lexer.c --exclude src/parser.c --exclude src/util.c  --gcov-options '\-lp'
    - compiler: gcc
      env: ENABLE_PYTHON=--enable-python-bindings
      before_install: pip install --user cython
      after_failure: cat bindings/check-python.log
    - compiler: clang    

before_script:
  - autoreconf -i
  - ./configure --enable-check CFLAGS="-fPIC -O2" $ENABLE_COVERAGE $ENABLE_PYTHON

script: make && make check

after_failure: cat test-api.log test-static.log test-memerr.log test-cli.log
